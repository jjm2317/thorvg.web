<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Lottie Web Advanced Example</title>
    <meta name="description" content="Advanced lottie-web example with multiple animations and performance monitoring" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
  </head>
  <body>
    <div>
      <h1>Lottie Web 고급 예제</h1>
      
      <div class="controls">
        <div class="control-group">
          <h3>기본 컨트롤</h3>
          <button onclick="playAll()">모두 재생</button>
          <button onclick="pauseAll()">모두 일시정지</button>
          <button onclick="stopAll()">모두 정지</button>
          <button onclick="createMultipleAnimations()">여러 애니메이션 생성</button>
          <button onclick="destroyAll()">모두 삭제</button>
        </div>
        
        <div class="control-group">
          <h3>애니메이션 설정</h3>
          <div>
            <label for="loopCheckbox">루프</label>
            <input type="checkbox" id="loopCheckbox" onchange="toggleLoopAll(event)" checked>
          </div>
          <div>
            <label for="speedRange">속도</label>
            <input type="range" id="speedRange" min="0.1" max="3" step="0.1" value="1" onchange="changeSpeedAll(this.value)">
            <span id="speedValue">1.0</span>
          </div>
          <div>
            <label for="frameRange">프레임</label>
            <input type="range" id="frameRange" min="0" max="100" step="1" value="0" onchange="seekFrameAll(this.value)">
            <span id="frameValue">0%</span>
          </div>
        </div>
        
        <div class="control-group">
          <h3>성능 모니터링</h3>
          <div id="performance-info">
            <div>FPS: <span id="fps">0</span></div>
            <div>메모리 사용량: <span id="memory">0</span> MB</div>
            <div>활성 애니메이션: <span id="activeCount">0</span></div>
          </div>
          <button onclick="togglePerformanceMonitoring()">성능 모니터링 토글</button>
        </div>
        
        <div class="control-group">
          <h3>애니메이션 URL</h3>
          <input type="text" id="animationUrl" placeholder="Animation URL" value="https://lottie.host/6d7dd6e2-ab92-4e98-826a-2f8430768886/NGnHQ6brWA.json"/>
          <button onclick="loadCustomAnimation()">커스텀 애니메이션 로드</button>
        </div>
      </div>

      <div id="lottie-container"></div>
      
      <div class="event-log">
        <h3>이벤트 로그</h3>
        <div id="eventLog"></div>
        <button onclick="clearEventLog()">로그 지우기</button>
      </div>
    </div>
    
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      
      .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      
      .control-group {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      
      .control-group h3 {
        margin-top: 0;
        color: #007bff;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
      }
      
      button {
        margin: 5px;
        padding: 10px 16px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      
      button:hover {
        background-color: #0056b3;
      }
      
      button:active {
        transform: translateY(1px);
      }
      
      #lottie-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      
      .animation-item {
        background: white;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        position: relative;
      }
      
      .animation-item .animation-controls {
        margin-top: 10px;
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
      }
      
      .animation-item .animation-controls button {
        padding: 5px 10px;
        font-size: 12px;
      }
      
      .animation-item .status {
        position: absolute;
        top: 5px;
        right: 5px;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: #28a745;
      }
      
      .animation-item .status.paused {
        background-color: #ffc107;
      }
      
      .animation-item .status.stopped {
        background-color: #dc3545;
      }
      
      input[type="range"] {
        width: 150px;
        margin: 0 10px;
      }
      
      label {
        margin-right: 10px;
        font-weight: bold;
      }
      
      #animationUrl {
        width: 100%;
        padding: 8px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }
      
      #performance-info {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
      
      #performance-info div {
        margin: 5px 0;
        font-family: monospace;
      }
      
      .event-log {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-top: 20px;
      }
      
      #eventLog {
        height: 200px;
        overflow-y: auto;
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
        margin: 10px 0;
      }
      
      .log-entry {
        margin: 2px 0;
        padding: 2px 0;
      }
      
      .log-entry.info { color: #007bff; }
      .log-entry.success { color: #28a745; }
      .log-entry.warning { color: #ffc107; }
      .log-entry.error { color: #dc3545; }
    </style>
    
    <script>
      let animations = [];
      let animationCount = 0;
      let performanceMonitoring = false;
      let performanceInterval;
      
      const lottie = window.lottie;
      
      function logEvent(message, type = 'info') {
        const eventLog = document.getElementById('eventLog');
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = document.createElement('div');
        logEntry.className = `log-entry ${type}`;
        logEntry.textContent = `[${timestamp}] ${message}`;
        eventLog.appendChild(logEntry);
        eventLog.scrollTop = eventLog.scrollHeight;
      }
      
      function createAnimation(url = null) {
        const container = document.getElementById('lottie-container');
        const urlInput = document.getElementById('animationUrl');
        const animationUrl = url || urlInput.value.trim();
        
        if (!animationUrl) {
          logEvent('애니메이션 URL이 입력되지 않았습니다', 'error');
          return;
        }
        
        // 새로운 애니메이션 컨테이너 생성
        const animationDiv = document.createElement('div');
        animationDiv.className = 'animation-item';
        animationDiv.style.width = '200px';
        animationDiv.style.height = '200px';
        animationDiv.id = `animation-${animationCount}`;
        
        // 상태 표시기 추가
        const statusIndicator = document.createElement('div');
        statusIndicator.className = 'status';
        animationDiv.appendChild(statusIndicator);
        
        // 컨트롤 버튼들 추가
        const controls = document.createElement('div');
        controls.className = 'animation-controls';
        controls.innerHTML = `
          <button onclick="playSingle(${animationCount})">재생</button>
          <button onclick="pauseSingle(${animationCount})">일시정지</button>
          <button onclick="stopSingle(${animationCount})">정지</button>
          <button onclick="destroySingle(${animationCount})">삭제</button>
        `;
        animationDiv.appendChild(controls);
        
        container.appendChild(animationDiv);
        
        // lottie 애니메이션 로드
        const animation = lottie.loadAnimation({
          container: animationDiv,
          renderer: 'svg',
          loop: true,
          autoplay: true,
          path: animationUrl
        });
        
        // 애니메이션 객체 저장
        animations.push({
          id: animationCount,
          instance: animation,
          container: animationDiv,
          statusIndicator: statusIndicator
        });
        
        // 이벤트 리스너들 추가
        animation.addEventListener('enterFrame', function(e) {
          updateFrameProgress(e.currentTime, animation.totalFrames);
        });
        
        animation.addEventListener('complete', function() {
          logEvent(`애니메이션 ${animationCount} 완료됨`, 'success');
        });
        
        animation.addEventListener('loopComplete', function() {
          logEvent(`애니메이션 ${animationCount} 루프 완료`, 'info');
        });
        
        animation.addEventListener('data_ready', function() {
          logEvent(`애니메이션 ${animationCount} 데이터 로드 완료`, 'success');
        });
        
        animation.addEventListener('data_failed', function() {
          logEvent(`애니메이션 ${animationCount} 데이터 로드 실패`, 'error');
        });
        
        animationCount++;
        logEvent(`애니메이션 ${animationCount} 생성됨`, 'success');
        updateActiveCount();
      }
      
      function createMultipleAnimations() {
        const urls = [
          'https://lottie.host/6d7dd6e2-ab92-4e98-826a-2f8430768886/NGnHQ6brWA.json',
          'https://assets2.lottiefiles.com/packages/lf20_UJNc2t.json',
          'https://assets5.lottiefiles.com/packages/lf20_2znxgjyt.json'
        ];
        
        urls.forEach((url, index) => {
          setTimeout(() => {
            createAnimation(url);
          }, index * 500);
        });
      }
      
      function playAll() {
        if (animations.length === 0) {
          logEvent('재생할 애니메이션이 없습니다', 'warning');
          return;
        }
        
        animations.forEach(anim => {
          anim.instance.play();
          anim.statusIndicator.className = 'status';
        });
        logEvent('모든 애니메이션 재생 시작', 'success');
      }
      
      function pauseAll() {
        if (animations.length === 0) {
          logEvent('일시정지할 애니메이션이 없습니다', 'warning');
          return;
        }
        
        animations.forEach(anim => {
          anim.instance.pause();
          anim.statusIndicator.className = 'status paused';
        });
        logEvent('모든 애니메이션 일시정지', 'info');
      }
      
      function stopAll() {
        if (animations.length === 0) {
          logEvent('정지할 애니메이션이 없습니다', 'warning');
          return;
        }
        
        animations.forEach(anim => {
          anim.instance.stop();
          anim.statusIndicator.className = 'status stopped';
        });
        logEvent('모든 애니메이션 정지', 'info');
      }
      
      function destroyAll() {
        if (animations.length === 0) {
          logEvent('삭제할 애니메이션이 없습니다', 'warning');
          return;
        }
        
        animations.forEach(anim => {
          anim.instance.destroy();
          anim.container.remove();
        });
        
        animations = [];
        animationCount = 0;
        logEvent('모든 애니메이션 삭제됨', 'success');
        updateActiveCount();
      }
      
      function playSingle(id) {
        const anim = animations.find(a => a.id === id);
        if (anim) {
          anim.instance.play();
          anim.statusIndicator.className = 'status';
          logEvent(`애니메이션 ${id} 재생`, 'info');
        }
      }
      
      function pauseSingle(id) {
        const anim = animations.find(a => a.id === id);
        if (anim) {
          anim.instance.pause();
          anim.statusIndicator.className = 'status paused';
          logEvent(`애니메이션 ${id} 일시정지`, 'info');
        }
      }
      
      function stopSingle(id) {
        const anim = animations.find(a => a.id === id);
        if (anim) {
          anim.instance.stop();
          anim.statusIndicator.className = 'status stopped';
          logEvent(`애니메이션 ${id} 정지`, 'info');
        }
      }
      
      function destroySingle(id) {
        const anim = animations.find(a => a.id === id);
        if (anim) {
          anim.instance.destroy();
          anim.container.remove();
          animations = animations.filter(a => a.id !== id);
          logEvent(`애니메이션 ${id} 삭제됨`, 'success');
          updateActiveCount();
        }
      }
      
      function updateFrameProgress(currentTime, totalFrames) {
        const frameRange = document.getElementById('frameRange');
        const frameValue = document.getElementById('frameValue');
        if (frameRange && frameValue) {
          const progress = (currentTime / totalFrames) * 100;
          frameRange.value = progress;
          frameValue.textContent = `${Math.round(progress)}%`;
        }
      }
      
      function seekFrameAll(framePercentage) {
        if (animations.length === 0) {
          logEvent('프레임 이동할 애니메이션이 없습니다', 'warning');
          return;
        }
        
        animations.forEach(anim => {
          const frame = (anim.instance.totalFrames * framePercentage) / 100;
          anim.instance.goToAndStop(frame, true);
        });
      }
      
      function toggleLoopAll(e) {
        if (animations.length === 0) {
          logEvent('루프 설정할 애니메이션이 없습니다', 'warning');
          return;
        }
        
        animations.forEach(anim => {
          anim.instance.loop = e.target.checked;
        });
        logEvent(`루프 ${e.target.checked ? '활성화' : '비활성화'}`, 'info');
      }
      
      function changeSpeedAll(speed) {
        if (animations.length === 0) {
          logEvent('속도 변경할 애니메이션이 없습니다', 'warning');
          return;
        }
        
        animations.forEach(anim => {
          anim.instance.setSpeed(speed);
        });
        
        document.getElementById('speedValue').textContent = speed;
        logEvent(`속도를 ${speed}로 변경`, 'info');
      }
      
      function loadCustomAnimation() {
        createAnimation();
      }
      
      function updateActiveCount() {
        document.getElementById('activeCount').textContent = animations.length;
      }
      
      function togglePerformanceMonitoring() {
        performanceMonitoring = !performanceMonitoring;
        
        if (performanceMonitoring) {
          startPerformanceMonitoring();
          logEvent('성능 모니터링 시작', 'success');
        } else {
          stopPerformanceMonitoring();
          logEvent('성능 모니터링 중지', 'info');
        }
      }
      
      function startPerformanceMonitoring() {
        let frameCount = 0;
        let lastTime = performance.now();
        
        performanceInterval = setInterval(() => {
          const currentTime = performance.now();
          const deltaTime = currentTime - lastTime;
          const fps = Math.round((frameCount * 1000) / deltaTime);
          
          document.getElementById('fps').textContent = fps;
          
          // 메모리 사용량 추정 (실제로는 더 정확한 방법 필요)
          if (window.performance && window.performance.memory) {
            const memoryMB = Math.round(window.performance.memory.usedJSHeapSize / 1024 / 1024);
            document.getElementById('memory').textContent = memoryMB;
          }
          
          frameCount = 0;
          lastTime = currentTime;
        }, 1000);
        
        // FPS 계산을 위한 프레임 카운터
        function countFrame() {
          frameCount++;
          if (performanceMonitoring) {
            requestAnimationFrame(countFrame);
          }
        }
        requestAnimationFrame(countFrame);
      }
      
      function stopPerformanceMonitoring() {
        if (performanceInterval) {
          clearInterval(performanceInterval);
          performanceInterval = null;
        }
      }
      
      function clearEventLog() {
        document.getElementById('eventLog').innerHTML = '';
      }
      
      // 전역 함수로 노출
      window.playAll = playAll;
      window.pauseAll = pauseAll;
      window.stopAll = stopAll;
      window.createMultipleAnimations = createMultipleAnimations;
      window.destroyAll = destroyAll;
      window.playSingle = playSingle;
      window.pauseSingle = pauseSingle;
      window.stopSingle = stopSingle;
      window.destroySingle = destroySingle;
      window.seekFrameAll = seekFrameAll;
      window.toggleLoopAll = toggleLoopAll;
      window.changeSpeedAll = changeSpeedAll;
      window.loadCustomAnimation = loadCustomAnimation;
      window.togglePerformanceMonitoring = togglePerformanceMonitoring;
      window.clearEventLog = clearEventLog;
      
      // 페이지 로드 시 초기화
      window.onload = function() {
        logEvent('페이지 로드 완료', 'success');
        updateActiveCount();
      };
    </script>
  </body>
</html> 